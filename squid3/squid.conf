####################################################################
# WELCOME TO SQUID-3 High Performance Configuration
# Modifed	: Bandi Shippuden
# Email 	: bandi_shippuden@hackermail.com
# Telp/HP	: 0823-9033-5639
####################################################################
# refresh pattern configuration here
####################################################################
include /etc/squid3/squid.refresh.config

####################################################################
# HAVP + Clamav
####################################################################
cache_peer 127.0.0.1 parent 8080 0 no-query no-digest no-netdb-exchange default

####################################################################
# Baris di bawah ini u/ squidGuard (comment-out jika tdk pakai squiGuard)
####################################################################
url_rewrite_program /usr/local/bin/squidGuard -c /usr/local/squidGuard/squidGuard.conf
url_rewrite_children 20

####################################################################
#  ACCESS CONTROLS
####################################################################
include /etc/squid3/squid.acl.config

####################################################################
# SSL_BUMP OPTION
####################################################################
ssl_bump server-first all
sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER
debug_options ALL,1 33,2

####################################################################
# SSL_BUMP PROGRAM
####################################################################
sslcrtd_program /usr/lib/squid3/ssl_crtd -s  /var/lib/ssl_db -M 16MB
sslcrtd_children 5

####################################################################
# TRANSPARENT TPROXY
####################################################################
http_port 3128 tproxy
http_port 3127 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=16MB key=/etc/squid3/ssl_cert/squid.key cert=/etc/squid3/ssl_cert/squid.pem
https_port 3129 tproxy ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=16MB key=/etc/squid3/ssl_cert/squid.key cert=/etc/squid3/ssl_cert/squid.pem


####################################################################
# OPTIONS WHICH AFFECT THE NEIGHBOR SELECTION ALGORITHM
####################################################################
hierarchy_stoplist (ini|lst|inf|update.txt|vdf.info.gz|captcha|reset.css|gamenotice|ickernew.css|blank.html|infinity.js|renew_session_token.php|recaptcha.js)

####################################################################
# STOREURL PROGRAME
####################################################################
store_id_program /etc/squid3/test.pl
store_id_children 20 startup=10 idle=5 concurrency=0
redirect_rewrites_host_header on
redirector_bypass on

icp_access allow localnet
icp_access deny all
icp_port 0

####################################################################
# TUNING LUSCA_HEAD-rr14945
####################################################################
ipcache_size 17048						# 2x Besar RAM 
fqdncache_size 8024						# real RAM Hardware
ipcache_low 98
ipcache_high 99
log_icp_queries off
half_closed_clients off
quick_abort_min 0 KB
quick_abort_max 0 KB
quick_abort_pct 98
vary_ignore_expire on
reload_into_ims on
forwarded_for off
client_db on
icp_hit_stale on
query_icmp on
negative_ttl 30 seconds
max_filedescriptors 65536
uri_whitespace strip
shutdown_lifetime 10 seconds
logfile_rotate 2

nonhierarchical_direct on
prefer_direct off
high_page_fault_warning 2

####################################################################
# ZPH QOS for NO Limit HIT trafick
####################################################################
qos_flows local-hit=0x30

####################################################################
# MEMORY CACHE OPTIONS
####################################################################
cache_mem 32 MB
maximum_object_size_in_memory 1024 KB
memory_replacement_policy heap GDSF
memory_pools off

####################################################################
# DISK CACHE OPTIONS
####################################################################
cache_replacement_policy heap LFUDA
store_dir_select_algorithm round-robin
minimum_object_size 0 bytes
maximum_object_size 10024 MB
cache_swap_low 98
cache_swap_high 99

cache_dir aufs /cache-10 20000 20 256
cache_dir aufs /cache-11 20000 20 256
cache_dir aufs /cache-12 20000 20 256
cache_dir aufs /cache-14 20000 20 256
cache_dir aufs /cache-15 20000 20 256

####################################################################
# PATCH/LOG FILE OPTIONS
####################################################################
pid_filename /var/run/squid3.pid
mime_table /etc/squid3/mime.conf
coredump_dir /var/spool/squid3
icon_directory /usr/share/squid3/icons
error_directory /usr/share/squid3/errors/en

access_log daemon:/var/log/squid3/access.log squid
cache_swap_log /var/log/squid/swap.state
cache_log /dev/null
cache_store_log /dev/null

####################################################################
# DNS OPTIONS jika Menggunakan DNS Unbond/Bind
####################################################################
dns_timeout 1 minutes
hosts_file /etc/hosts
dns_nameservers 192.168.10.251 127.0.0.1

####################################################################
# SNMP OPTIONS
####################################################################
snmp_port 3401
snmp_access allow snmppublic all

####################################################################
# ADMINISTRATIVE PARAMETERS
####################################################################
cache_mgr bandi.shippuden@gmail.com
cache_effective_user proxy
cache_effective_group proxy
visible_hostname bandi-shippuden.admin.net
unique_hostname bandi-shippuden.admin.net

####################################################################
# QLPROXY
####################################################################
icap_enable on
icap_preview_enable on
icap_preview_size 4096
icap_persistent_connections on
#icap_send_client_ip on
icap_send_client_username on
#icap_client_username_header X-Client-Username
#icap_service qlproxy1 reqmod_precache bypass=0 icap://127.0.0.1:1344/reqmod
#icap_service qlproxy2 respmod_precache bypass=0 icap://127.0.0.1:1344/respmod
#adaptation_access qlproxy1 allow all
#adaptation_access qlproxy2 allow all
# End of file
