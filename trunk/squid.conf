####################################################################
# WELCOME TO SQUID-3.4
# Kofigurasi squid.3.4 dengan ssl_bump dan store-id
# Author	: Bandi Shippuden
# Email		: bandi.shippuden@gmail.com
####################################################################
## START KONFIGURASI
####################################################################
## TAG : ACCESS CONTROLS
####################################################################
acl localnet src 192.168.10.0/24	# LOCAL NET IP ADDRESS ALLOWED
acl localnet src 192.168.11.0/24	# HOTSPOT IP ADDRESS ALLOEWD

acl snmppublic snmp_community public

acl SSL_ports port 443
acl Safe_ports port 80   			# http
acl Safe_ports port 8080			# http alt
acl Safe_ports port 8000
acl Safe_ports port 443 			# https
acl Safe_ports port 20 21  			# ftp
acl Safe_ports port 70   			# gopher
acl Safe_ports port 210   			# wais
acl Safe_ports port 1025-65535  		# unregistered ports
acl Safe_ports port 631   			# cups
acl Safe_ports port 10000  			# webmin
acl Safe_ports port 901   			# SWAT
acl Safe_ports port 280   			# http-mgmt
acl Safe_ports port 488   			# gss-http
acl Safe_ports port 591   			# filemaker
acl Safe_ports port 777   			# multiling http
acl PURGE method PURGE
acl CONNECT method CONNECT

####################################################################
## TAG: OPTIONS WHICH AFFECT THE NEIGHBOR SELECTION ALGORITHM
####################################################################
hierarchy_stoplist (aspx|ini|lst|inf|update.txt|vdf.info.gz|captcha|reset.css|gamenotice|ickernew.css|blank.html|infinity.js|renew_session_token.php|recaptcha.js)

####################################################################
## TAG: ACL ADS/IKLAN BLOCK
####################################################################
include /etc/squid/squid.ads.config

acl chrome-update url_regex -i ^http\:\/\/cache\.pack\.google\.com\/(crx|edgedl)\/.*
http_access deny chrome-update

acl updategame_nocache url_regex -i \.gemscool\.com\/lsaga\/.*\.(txt|ini)

acl general dstdomain .gamebox.com
ssl_bump none general

####################################################################
## TAG: ACL NO CACHE/FIX CACHE SQUID
####################################################################
acl QUERY urlpath_regex -i (hackshield|blank.html|infinity.js|hshield.da|renew_session_token.php|recaptcha.js|dat.asp|notice.swf|patchlist.txt|hackshield|captcha|reset.css|update.ver|notice.html|updates.txt|gamenotice|images.kom|patchinfo.xml|noupdate.ui|\.Xtp|\.htc)
acl QUERY urlpath_regex -i (server_patch.cfg.iop|core.swf|Loading.swf|resouececheck.sq|mainloading.swf|config.xml|gemmaze.swf|xml.png|size.xml|resourcesbar.swf|version.xml|version.list|delete.ini)$
acl QUERY urlpath_regex -i \.(aspx|asx|lst|php).*$

acl ym dstdomain .messenger.yahoo.com .psq.yahoo.com
acl ym dstdomain .us.il.yimg.com .msg.yahoo.com .pager.yahoo.com
acl ym dstdomain .rareedge.com .ytunnelpro.com .chat.yahoo.com
acl ym dstdomain .voice.yahoo.com
acl ym dstdomain .skype.com .imvu.com
acl ym dstdomain .gmail.com .mail.google.com .accounts.google.com .mail.google.co.id .gmail.co.id
acl login-yahoo dstdomain .login.yahoo.com .ib.bri.co.id
acl ymregex url_regex yupdater.yim ymsgr myspaceim

http_access allow manager localhost
http_access deny manager
http_access allow PURGE localhost
http_access deny PURGE
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localnet
http_access deny all

cache deny updategame_nocache
cache deny QUERY
cache deny ym

always_direct allow ym login-yahoo ymregex

####################################################################
## TAG: NETWORK OPTIONS
####################################################################
http_port 3128 tproxy
http_port 3127
https_port 3129 tproxy ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=16MB cert=/etc/squid/ssl_certs/squid.pem key=/etc/squid/ssl_certs/squid.key

####################################################################
## TAG: ZPH QOS for NO Limit HIT trafick
####################################################################
qos_flows local-hit=0x30

####################################################################
## TAG: SSL_BUMP OPTIONS
####################################################################
always_direct allow all
ssl_bump server-first all
sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER
sslproxy_cert_error deny all

####################################################################
## TAG: OPTIONS RELATING TO EXTERNAL SSL_CRTD 
####################################################################
sslcrtd_program /usr/lib/squid/ssl_crtd -s  /usr/local/squid/ssl_db/certs -M 16MB
sslcrtd_children 32 startup=1 idle=1

####################################################################
## TAG: MEMORY CACHE OPTIONS
####################################################################
memory_pools off
cache_mem 512 MB
maximum_object_size_in_memory 512 KB
memory_replacement_policy heap GDSF

####################################################################
## TAG: DISK CACHE OPTIONS
####################################################################
cache_replacement_policy heap LFUDA
store_dir_select_algorithm round-robin
minimum_object_size 2 bytes
maximum_object_size 10 GB
cache_swap_low 98
cache_swap_high 99

cache_dir aufs /cache_proxy-01 60000 14 256
cache_dir aufs /cache_proxy-02 60000 14 256
cache_dir aufs /cache_proxy-03 60000 14 256

# DISK Cadangan
###################################################################
#cache_dir aufs /cache-01 23000 5 256
#cache_dir aufs /cache-02 23000 5 256
#cache_dir aufs /cache-03 23000 5 256
#cache_dir aufs /cache-04 23000 5 256
#cache_dir aufs /cache-05 23000 5 256
#cache_dir aufs /cache-06 23000 5 256

###################################################################
## TAG: LOGFILE OPTIONS
###################################################################
request_body_max_size 0 KB
access_log stdio:/tmp/access.log
cache_log /tmp/cache.log
cache_store_log none

#debug helper
#debug_options ALL,1 84,9
     
#debug refresh_pattern
#debug_options ALL,1 22,3
     
#debug ACL
#debug_options ALL,1 33,2 28,9
     
#debug squid.conf
#debug_options ALL,1 33,2

####################################################################
# PATCH/LOG FILE OPTIONS
####################################################################
pid_filename /var/run/squid.pid
mime_table /etc/squid/mime.conf
coredump_dir /var/spool/squid
icon_directory /usr/share/squid/icons
error_directory /usr/share/squid/errors/en

############################################################################
# TUNING SQUID.3.4
############################################################################
#Speedtest
acl speedtest dstdom_regex -i speedtest.*\.
acl store_id_list urlpath_regex .*\/speedtest\/.*\.(jpg|txt)

# Youtube Video
acl yutube url_regex -i youtube\.com\/(ptracking|stream_204|player_204|gen_204|s|(.*(playback|watchtime|delayplay))).*$
acl yutube url_regex -i (youtube|googlevideo)\.com\/videoplayback.*$

#acl yutube url_regex ^https?\:\/\/([0-9.]{4}|.*\.youtube\.com|.*\.googlevideo\.com|.*\.video\.google\.com)\/(get_video\?|videodownload\?|videoplayback.*id|videoplayback\?).*$
#acl store_id_list_url url_regex 9.]{4}|.*\.youtube\.com|.*\.googlevideo\.com|.*\.video\.google\.com)\/stream_204\?.*docid=.*$
#acl store_id_list_url url_regex 9.]{4}|.*\.youtube\.com|.*\.googlevideo\.com|.*\.video\.google\.com)\/player_204\?.*v=.*$
#acl store_id_list_url url_regex 9.]{4}|.*\.youtube\.com|.*\.googlevideo\.com|.*\.video\.google\.com)\/ptracking\?.*video_id=.*$
#acl store_id_list_url url_regex 9.]{4}|.*\.youtube\.com|.*\.googlevideo\.com|.*\.video\.google\.com)\/(stream_204|player_204|ptracking)\?.*cpn=.*$

acl store_id_list urlpath_regex [a-zA-Z]{2}[0-9]*\.4shared\.com\/download\/
acl store_id_list urlpath_regex \.(jp(e?g|e|2)|gif|png|tiff?|bmp|ico|flv|wmv|3gp|mp(4|3)|exe|msi|zip|on2|mar|rar|cab)(\?|.*$)
acl store_id_list_domain url_regex ^http:\/\/([a-zA-Z-]+[0-9-]+)\.[A-Za-z]*\.[A-Za-z]*
acl store_id_list_domain url_regex (([a-z]{1,2}[0-9]{1,3})|([0-9]{1,3}[a-z]{1,2}))\.[a-z]*[0-9]?\.[a-z]{3}

acl store_id_list_url url_regex ak\.fbcdn\.net
acl store_id_list_url url_regex i[1-9].ytimg.com
acl store_id_list_url url_regex \.rapidshare\.com.*\/[0-9]*\/.*\/[^\/]* ^http:\/\/(www\.ziddu\.com.*\.[^\/]{3,4})\/(.*) \.doubleclick\.net.*
acl store_id_list_url url_regex ^http:\/\/[.a-z0-9]*\.photobucket\.com.*\.[a-z]{3}$ quantserve\.com
acl store_id_list_url url_regex ^http:\/\/[a-z]+[0-9]\.google\.co(m|\.id)
acl store_id_list_url url_regex ^http:\/\/\.www[0-9][0-9]\.indowebster\.com\/(.*)(rar|zip|flv|wm(a|v)|3gp|mp(4|3)|exe|msi|avi|(mp(e?g|a|e|1|2|3|4))|cab|exe)

acl dontrewrite url_regex \.(php|asp|aspx|jspx|js|cgi)\?
acl dontrewrite url_regex ^http:\/\/(([\d\w-]*(\.[^\.\-]*?\..*?))(\/\mosalsal\/[\d]{4}\/.*\/)(.*\.flv))\?start.*
acl dontrewrite url_regex redbot\.org \.php
acl dontrewrite url_regex goldprice\.org\/NewCharts\/gold\/images\/.*\.png
acl dontrewrite url_regex google\.co(m|\.[a-z]{2})\/complete\/search\?
acl dontrewrite url_regex redirector\.([0-9.]{4}|.*\.youtube\.com|.*\.googlevideo\.com|.*\.video\.google\.com)\/(get_video\?|videodownload\?|videoplayback.*id|get_video_info\?|ptracking\?|player_204\?|stream_204\?).*
acl getmethod method GET


store_id_program /etc/squid/store-id.pl
store_id_children 40 startup=0 idle=5 concurrency=100

store_id_access allow speedtest
store_id_access allow yutube
store_id_access allow store_id_list_url
store_id_access allow store_id_list
store_id_access allow store_id_list_domain
store_id_access deny dontrewrite
store_id_access deny !getmethod
store_id_access deny all

acl loop_302 http_status 302
store_miss deny yutube loop_302
send_hit deny yutube loop_302

redirector_bypass on


# RANGE NONE
acl youtube_206 url_regex -i ^https?\:\/\/.*(youtube|googlevideo).*videoplayback.*$
range_offset_limit 128 KB youtube_206

acl patch_game url_regex \.netmarble\.co.\id\/Modoo\/Patch.*\.zip
acl patch_game url_regex -i ^http:\/\/*.patch\.gemscool\.com\/.*dragonnest.*\/.*live.*\.pak$
range_offset_limit none patch_game

acl google_url url_regex -i ^http\:\/\/download\.cdn\.mozilla\.net\/pub\/firefox\/.*\.(exe|mar).*$
acl google_url url_regex -i ^http:\/\/.*adobe\.com\/pub\/adobe.*\.exe
range_offset_limit none google_url 

acl game_facebook url_regex \.go-games.org.*\.swf
range_offset_limit none game_facebook

####################################################################
## TAG: OPTIONS FOR TUNING THE CACHE
####################################################################
client_persistent_connections off
server_persistent_connections on 

ipcache_low 98
ipcache_high 99
ipcache_size 8024						# 2x Besar RAM 
fqdncache_size 8024						# real RAM Hardware

quick_abort_min 0 KB
quick_abort_max 0 KB
quick_abort_pct 100
uri_whitespace strip
half_closed_clients off

store_avg_object_size 128 KB
shutdown_lifetime 10 seconds

log_icp_queries off
buffered_logs off
logfile_rotate 1

#via off
#forwarded_for off
#offline_mode off

#icp_hit_stale on
#query_icmp on

vary_ignore_expire on
reload_into_ims on

max_filedescriptors 65536

####################################################################
# DNS OPTIONS jika Menggunakan DNS Unbond/Bind
####################################################################
dns_defnames on
dns_timeout 1 minutes
hosts_file /etc/hosts
dns_nameservers 127.0.0.1 192.168.10.251
positive_dns_ttl 6 hours
negative_dns_ttl 60 seconds

####################################################################
# ADMINISTRATIVE PARAMETERS
####################################################################
cache_mgr bandi.shippuden@gmail.com
cache_effective_user proxy
cache_effective_group proxy
visible_hostname bandi-shippuden.admin.net
unique_hostname bandi-shippuden.admin.net

####################################################################
# refresh pattern configuration here
####################################################################
# max_stale 1 week
refresh_pattern -i  \.(sc-|dl-|ex-|mh-|mst|dll)$                0  20% 1440
refresh_pattern -i (main.exe|notice.html)$                      0  20% 0
refresh_pattern -i (livescore.com|UpdaterModifier.exe|FreeStyle.exe|FSLauncher.exe) 0  20% 0
refresh_pattern (get_video|videoplayback|videodownload|\.flv).*(begin|start)\=[1-9][0-9]*       0 0% 0
refresh_pattern imeem.*\.flv  0 0% 0  override-lastmod override-expire
refresh_pattern -i (livescore.com|UpdaterModifier.exe|FreeStyle.exe|FSLauncher.exe) 0  20% 0

# Youtube Video
refresh_pattern -i (get_video\?|videoplayback\?|videodownload\?) 5259487 100% 5259487 override-expire ignore-reload ignore-private ignore-no-cache
refresh_pattern -i (youtube|googlevideo)\.com.*(get_video\?|videoplayback\?|videodownload\?|\.flv($|\?)|\.mp4($|\?)|\.webm($|\?)|\.x-flv($|\?)) 483840 100% 483840 override-expire ignore-reload ignore-no-cache  ignore-private ignore-no-store ignore-auth
refresh_pattern -i (audio\/mp4|video\/mp4)$ 5259487 100% 5259487 override-expire ignore-reload ignore-private ignore-no-cache

# Image Youtube
refresh_pattern -i (yimg|twimg)\.com 129600 100% 129600 override-expire ignore-reload ignore-no-cache ignore-private ignore-auth ignore-no-store
refresh_pattern -i (ytimg|ggpht)\.com.*\.(jpg|png|swf|flv|mp3|gif|webp)($|\?)	483840 100% 483840 override-expire ignore-reload store-stale

refresh_pattern ^https?\:\/\/199\.91\.15\d\.\d*\/\w{12}\/(\w*)\/(.*)  129600 100% 129600 ignore-no-cache ignore-no-store ignore-private override-expire override-lastmod reload-into-ims store-stale
refresh_pattern \.(ico|video-stats) 129600 100% 129600 override-expire override-lastmod ignore-reload ignore-no-cache ignore-private ignore-auth ignore-no-store store-stale
refresh_pattern ^https?\://(cbk|mt|khm|mlt)[0-9]?)\.google\.co(m|\.id) 129600 100% 129600 override-expire ignore-reload ignore-private store-stale
refresh_pattern ^https?\://(kh|khmdb|mw1)\.google\.com 129600 100% 129600 override-expire ignore-reload ignore-private store-stale
refresh_pattern ^https?\:\/\/[a-z]+[0-9]\.google\.co(m|\.id) 129600 100% 129600 override-expire ignore-reload ignore-private store-stale

# Game Facebook
refresh_pattern ^https:\/\/apps.facebook.com 	10080 80% 43200 ignore-reload override-expire ignore-no-cache ignore-no-store store-stale
refresh_pattern -i \.zynga-[1-9].*net			10080 80% 43200 ignore-reload override-expire ignore-no-cache ignore-no-store ignore-must-revalidate store-stale
refresh_pattern -i \.zynga.com			10080 80% 43200 ignore-reload override-expire ignore-no-cache ignore-no-store ignore-must-revalidate store-stale
refresh_pattern -i \.farmville.com			10080 80% 43200 ignore-reload override-expire ignore-no-cache ignore-no-store ignore-must-revalidate store-stale
refresh_pattern -i \.ninjasaga.com			10080 80% 43200 ignore-reload override-expire ignore-no-cache ignore-no-store ignore-must-revalidate store-stale
refresh_pattern -i \.mafiawars.com		10080 80% 43200 ignore-reload override-expire ignore-no-cache ignore-no-store ignore-must-revalidate store-stale
refresh_pattern -i \.crowdstar.com 			10080 80% 43200 ignore-reload override-expire ignore-no-cache ignore-no-store ignore-must-revalidate store-stale
refresh_pattern -i \.popcap.com 			10080 80% 43200 ignore-reload override-expire ignore-no-cache ignore-no-store ignore-must-revalidate store-stale
refresh_pattern -i \.go-games.org		10080 80% 43200 ignore-reload override-expire ignore-no-cache ignore-no-store ignore-must-revalidate store-stale
refresh_pattern -i \.miniclipcdn.com		10080 80% 43200 ignore-reload override-expire ignore-no-cache ignore-no-store ignore-must-revalidate store-stale
refresh_pattern -i \.llnwd.net		10080 80% 43200 ignore-reload override-expire ignore-no-cache ignore-no-store ignore-must-revalidate store-stale
refresh_pattern -i \.cloudfront.net		10080 80% 43200 ignore-reload override-expire ignore-no-cache ignore-no-store ignore-must-revalidate ignore-private ignore-auth store-stale
refresh_pattern -i \.nordeus.com			10080 80% 43200 ignore-reload override-expire ignore-no-cache ignore-no-store ignore-must-revalidate store-stale

#images facebook
refresh_pattern -i \.akamaihd\.net 10080 80% 43200 override-expire override-lastmod reload-into-ims ignore-reload ignore-no-cache ignore-no-store ignore-private
refresh_pattern -i .*\.((facebook.com)|(85.131.151.39))\.(jpg|png|gif) 129600 99% 129600 ignore-reload override-expire ignore-no-cache ignore-no-store store-stale
refresh_pattern -i .*\.fbcdn\.net\/.*\.((jp(e?g|e|2)|gif|pn[pg]|bm?|tiff?|ico|swf|css|js)|(jp(e?g|e|2)|gif|pn[pg]|bm?|tiff?|ico|swf|css|js)\?) 129600 99% 129600 ignore-no-cache ignore-no-store ignore-private override-expire override-lastmod reload-into-ims
refresh_pattern static\.ak\.fbcdn\.net*\.(jpg|gif|png) 129600 99% 129600 ignore-reload override-expire ignore-no-cache ignore-no-store
refresh_pattern ^https?\:\/\/profile\.ak\.fbcdn.net*\.(jpg|gif|png) 129600 99% 129600 ignore-reload override-expire ignore-no-cache ignore-no-store

# Video Facebook
refresh_pattern -i \.video.ak.fbcdn.net.*\.(mp4|flv|mp3|amf)			10080 80% 43200 override-expire ignore-reload reload-into-ims ignore-no-cache ignore-private ignore-no-store ignore-must-revalidate

# Ads/Safe Browser
refresh_pattern ^.*safebrowsing.*google   131400 100% 525600 override-expire ignore-reload ignore-no-cache ignore-no-store ignore-private ignore-auth ignore-must-revalidate store-stale
refresh_pattern ^.*(streamate.doublepimp.com.*\.js\?|utm\.gif|ads\?|rmxads\.com|ad\.z5x\.net|bh\.contextweb\.com|bstats\.adbrite\.com|a1\.interclick\.com|ad\.trafficmp\.com|ads\.cubics\.com|ad\.xtendmedia\.com|\.googlesyndication\.com|advertising\.com|yieldmanager|game-advertising\.com|pixel\.quantserve\.com|adperium\.com|doubleclick\.net|adserving\.cpxinteractive\.com|syndication\.com|media.fastclick.net).* 5259487 20% 5259487 ignore-no-cache ignore-no-store ignore-private override-expire ignore-reload ignore-auth ignore-must-revalidate store-stale max-stale=1440

# Mediafire
refresh_pattern -i \.mediafire.com.*\.(jpg|png|gif|swf|mp3|ico|flv|zip|rar) 10080 100% 43200 override-expire ignore-reload reload-into-ims ignore-no-cache ignore-private ignore-no-store ignore-must-revalidate store-stale

# 4Shared
refresh_pattern ^http:\/\/[a-zA-Z]{2}\d*\.4shared\.com(:8080|)\/download\/(.*)\/(.*\..*)\?.* 10080 99% 60480 ignore-no-cache ignore-no-store ignore-private override-expire override-lastmod reload-into-ims store-stale
refresh_pattern ^http\:\/\/static\.4shared\.com\/.*\.(jpe?g|swf|png|ico|css|js|gif|wmv|avi|mp3|mp4|3gp|flv) 10080 99% 43200 ignore-reload reload-into-ims  store-stale
refresh_pattern ^http://download.*\.4shared\.com/ 10080 99% 5259487 override-expire reload-into-ims ignore-private ignore-no-cache store-stale

# BIOSKOP ONLINE
refresh_pattern -i nonton.me.*\.swf	10080 99% 43200 ignore-no-cache ignore-no-store reload-into-ims ignore-reload ignore-private

# Update Game Online
refresh_pattern -i \.pb.gemscool.com.*\.zip	10080 99% 43200 ignore-no-cache ignore-no-store ignore-must-revalidate reload-into-ims ignore-reload
refresh_pattern -i \.gemscool.com\/lsaga\/.*\.iop 10080 50% 43200 ignore-reload reload-into-ims ignore-no-cache
refresh_pattern -i \.netmarble.co.id.*\.(zip|exe)		10080 99% 43200 ignore-no-cache ignore-no-store ignore-must-revalidate reload-into-ims ignore-reload
refresh_pattern -i \.csonline.co.id.*\.nap 	10080 99% 43200 ignore-no-cache ignore-no-store ignore-must-revalidate reload-into-ims ignore-reload
refresh_pattern -i \.crossfire.web.id.*\.cab	10080 99% 43200 ignore-no-cache ignore-no-store ignore-must-revalidate reload-into-ims ignore-reload

# Update Antivirus
refresh_pattern -i eset.com.*\.(ver|nup) 10080 99% 43200 ignore-no-cache ignore-no-store reload-into-ims ignore-reload
refresh_pattern -i google.com.*\.(crx|exe)($|\?)	10080 99% 43200	ignore-no-cache ignore-no-store reload-into-ims ignore-reload ignore-private
	
# Windows Update
refresh_pattern windowsupdate.com.*\.(cab|exe)($|\?) 43200 99% 129600 ignore-no-cache ignore-no-store ignore-reload reload-into-ims store-stale
refresh_pattern update.microsoft.com.*\.(cab|exe)($|\?) 43200 99% 129600 ignore-no-cache ignore-no-store ignore-reload reload-into-ims store-stale
refresh_pattern download.microsoft.com.*\.(cab|exe)($|\?) 43200 99% 129600 ignore-no-cache ignore-no-store ignore-reload reload-into-ims store-stale
refresh_pattern download.windowsupdate.com.*\.(cab|exe)($|\?) 43200 99% 129600 ignore-no-cache ignore-no-store ignore-reload reload-into-ims store-stale

#IIX DOWNLOAD
refresh_pattern ^http:\/\/\.www[0-9][0-9]\.indowebster\.com\/(.*)(mp3|rar|zip|flv|wmv|3gp|mp(4|3)|exe|msi|zip) 43200 99% 129600 reload-into-ims ignore-reload override-expire ignore-no-cache ignore-no-store store-stale ignore-auth

#Option File dengan ?
refresh_pattern \.(jp(e?g|e|2)|tiff?|bmp|ico|gif|png)\? 5259487 99% 5259487 ignore-no-cache ignore-no-store reload-into-ims override-expire ignore-must-revalidate store-stale
refresh_pattern \.(z(ip|[0-9]{2})|r(ar|[0-9]{2})|jar|bz2|gz|7z|tar|rpm|vpu|cup)\? 5259487 99% 5259487 override-expire reload-into-ims
refresh_pattern \.(mp3|wav|og(g|a)|flac|midi?|rm|aac|wma|mka|ape|pak|nzp)\? 5259487 99% 5259487 override-expire reload-into-ims ignore-reload
refresh_pattern \.(exe|msi|dmg|bin|xpi|iso|swf|dat|mar|psf|cab)\? 5259487 99% 5259487 override-expire reload-into-ims ignore-no-cache ignore-must-revalidate
refresh_pattern \.(mpeg|ra?m|avi|mp(g|e|4)|mov|mkv|divx|asf|wmv|m\dv|rv|vob|asx|ogm|flv|3gp|on2)\? 5259487 99% 5259487 override-expire reload-into-ims

#Option File tanpa ?
refresh_pattern \.(jp(e?g|e|2)|tiff?|bmp|ico|gif|png) 5259487 99% 5259487 ignore-no-cache ignore-no-store reload-into-ims override-expire ignore-must-revalidate store-stale
refresh_pattern \.(z(ip|[0-9]{2})|r(ar|[0-9]{2})|jar|bz2|gz|7z|tar|rpm|vpu|cup) 5259487 99% 5259487 override-expire reload-into-ims
refresh_pattern \.(mp3|wav|og(g|a)|flac|midi?|rm|aac|wma|mka|ape|pak|nzp) 5259487 99% 5259487 override-expire reload-into-ims ignore-reload
refresh_pattern \.(exe|msi|dmg|bin|xpi|iso|swf|dat|mar|psf|cab) 5259487 99% 5259487 override-expire reload-into-ims ignore-no-cache ignore-must-revalidate
refresh_pattern \.(mpeg|ra?m|avi|mp(g|e|4)|mov|mkv|divx|asf|wmv|m\dv|rv|vob|asx|ogm|flv|3gp|on2) 5259487 99% 5259487 override-expire reload-into-ims

# ALL STORE-ID REGEX
refresh_pattern -i storeurl://.*squid.internal/* 	10080 100% 525600 override-expire override-lastmod reload-into-ims ignore-no-cache ignore-private ignore-reload ignore-no-store ignore-auth store-stale
refresh_pattern -i http://.*squid.internal/* 		10080 100% 525600 override-expire override-lastmod reload-into-ims ignore-no-cache ignore-private ignore-reload ignore-no-store ignore-auth store-stale

refresh_pattern ^ftp: 		40320   20%     40320   override-expire reload-into-ims store-stale
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern . 0 50% 40320 override-expire reload-into-ims

####################################################################
# SNMP
####################################################################
snmp_port 3401
snmp_access allow snmppublic localnet
snmp_access deny all

####################################################################
# REQUEST_HEADER_ACCESS OPTIONS
####################################################################
request_header_access X-Forwarded-For deny all
reply_header_access X-Forwarded-For deny all
request_header_access Range deny youtube_206
httpd_suppress_version_string on